# é—¯çº¢ç¯æ£€æµ‹ç³»ç»Ÿ (Traffic Violation Detection System)

åŸºäºYOLOv8çš„æ™ºèƒ½é—¯çº¢ç¯æ£€æµ‹ç³»ç»Ÿï¼Œæ”¯æŒè½¦è¾†è·Ÿè¸ªã€çº¢ç»¿ç¯è¯†åˆ«å’Œè¿è§„è¡Œä¸ºæ£€æµ‹ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âœ… **YOLOv8ç›®æ ‡æ£€æµ‹**: å®æ—¶æ£€æµ‹è½¦è¾†ã€è¡Œäººã€çº¢ç»¿ç¯
- âœ… **çº¢ç»¿ç¯åˆ†ç±»**: æ™ºèƒ½è¯†åˆ«çº¢ç»¿ç¯é¢œè‰²ï¼ˆçº¢/ç»¿/é»„ï¼‰
- âœ… **å¤šç›®æ ‡è·Ÿè¸ª**: åŸºäºIoUçš„è½»é‡çº§è·Ÿè¸ªå™¨ï¼ˆæ— éœ€è®­ç»ƒï¼‰
- âœ… **è¿è§„æ£€æµ‹**: è‡ªåŠ¨åˆ¤æ–­é—¯çº¢ç¯è¡Œä¸º
- âœ… **è¯¦ç»†åˆ†æ**: ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šå’Œç»Ÿè®¡å›¾è¡¨

## ğŸ“¦ ä¾èµ–è¦æ±‚

### æ ¸å¿ƒä¾èµ–

```bash
pip install ultralytics==8.0.196
pip install torch torchvision
pip install opencv-python
pip install numpy
pip install matplotlib
```

### å¯é€‰ä¾èµ–ï¼ˆç”¨äºåˆ†ç±»æ¨¡å‹ï¼‰

```bash
# å¦‚æœæ²¡æœ‰è®­ç»ƒå¥½çš„åˆ†ç±»æ¨¡å‹ï¼Œå¯ä»¥è·³è¿‡
# ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†è¿™ç§æƒ…å†µ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡æ–‡ä»¶

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼š

```
ğŸ“ é¡¹ç›®ç›®å½•/
â”œâ”€â”€ ğŸ“„ input.mp4              # è¾“å…¥è§†é¢‘ï¼ˆå¿…é¡»ï¼‰
â”œâ”€â”€ ğŸ“„ yolov8s.pt             # YOLOv8æ¨¡å‹ï¼ˆå·²æä¾›ï¼‰
â”œâ”€â”€ ğŸ“ models/
â”‚   â””â”€â”€ ğŸ“„ traffic_light_classifier.pth  # çº¢ç»¿ç¯åˆ†ç±»æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ ğŸ“„ traffic_violation_detector.py     # ä¸»æ£€æµ‹è„šæœ¬
â”œâ”€â”€ ğŸ“„ tracker.py             # è·Ÿè¸ªå™¨
â”œâ”€â”€ ğŸ“„ visualize_results.py   # å¯è§†åŒ–è„šæœ¬
â””â”€â”€ ğŸ“„ run_complete_system.py # ä¸€é”®è¿è¡Œè„šæœ¬
```

### 2. è¿è¡Œå®Œæ•´ç³»ç»Ÿ

```bash
# ä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰
python run_complete_system.py

# æˆ–åˆ†æ­¥è¿è¡Œ
python traffic_violation_detector.py    # è¿è¡Œæ£€æµ‹
python visualize_results.py             # ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
```

### 3. æŸ¥çœ‹ç»“æœ

æ£€æµ‹å®Œæˆåï¼Œä¼šç”Ÿæˆä»¥ä¸‹è¾“å‡ºæ–‡ä»¶ï¼š

```
ğŸ“ è¾“å‡ºæ–‡ä»¶/
â”œâ”€â”€ ğŸ“¹ output_traffic_violation.mp4                    # æ£€æµ‹ç»“æœè§†é¢‘
â”œâ”€â”€ ğŸ“„ traffic_violation_report.json                   # è¯¦ç»†æ£€æµ‹æŠ¥å‘Š
â”œâ”€â”€ ğŸ“„ violation_summary.txt                           # æ–‡æœ¬æ‘˜è¦æŠ¥å‘Š
â”œâ”€â”€ ğŸ“ charts/                                         # å¯è§†åŒ–å›¾è¡¨
â”‚   â”œâ”€â”€ ğŸ“Š detection_stats.png                         # æ£€æµ‹ç»Ÿè®¡é¥¼å›¾
â”‚   â”œâ”€â”€ ğŸ“Š traffic_light_distribution.png              # çº¢ç»¿ç¯çŠ¶æ€åˆ†å¸ƒ
â”‚   â”œâ”€â”€ ğŸ“Š violation_analysis.png                      # è¿è§„åˆ†æå›¾è¡¨
â”‚   â””â”€â”€ ğŸ“Š violation_timeline.png                      # è¿è§„æ—¶é—´çº¿
â””â”€â”€ ğŸ“¹ output_with_violation_annotations.mp4           # å¸¦è¿è§„æ ‡æ³¨çš„è§†é¢‘
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### åŸºç¡€æ£€æµ‹

```python
from traffic_violation_detector import TrafficViolationDetector

# åˆ›å»ºæ£€æµ‹å™¨
detector = TrafficViolationDetector(
    yolo_model_path="yolov8s.pt",
    classifier_model_path="models/traffic_light_classifier.pth"
)

# å¤„ç†è§†é¢‘
detector.process_video("input.mp4", "output.mp4")
```

### é«˜çº§é…ç½®

```python
# è‡ªå®šä¹‰åœæ­¢çº¿ä½ç½®
detector = TrafficViolationDetector(
    yolo_model_path="yolov8s.pt",
    stop_line_y=400  # è‡ªå®šä¹‰åœæ­¢çº¿Yåæ ‡
)

# è‡ªå®šä¹‰è·Ÿè¸ªå™¨å‚æ•°
from tracker import SimpleTracker
tracker = SimpleTracker(
    max_disappeared=30,  # æœ€å¤§æ¶ˆå¤±å¸§æ•°
    min_iou=0.3          # æœ€å°IoUé˜ˆå€¼
)
```

### å¯è§†åŒ–åˆ†æ

```python
from visualize_results import ViolationVisualizer

visualizer = ViolationVisualizer('traffic_violation_report.json')

# ç”Ÿæˆæ‰€æœ‰å¯è§†åŒ–è¾“å‡º
visualizer.generate_all_outputs('input.mp4')

# æˆ–å•ç‹¬ç”Ÿæˆ
visualizer.create_summary_report('my_report.txt')
visualizer.create_visual_charts('my_charts')
```

## ğŸ® å‘½ä»¤è¡Œå‚æ•°

### run_complete_system.py

```bash
python run_complete_system.py [é€‰é¡¹]

é€‰é¡¹:
  --skip-deps-check      è·³è¿‡ä¾èµ–æ£€æŸ¥
  --skip-detection       è·³è¿‡æ£€æµ‹æ­¥éª¤ï¼ˆä½¿ç”¨ç°æœ‰æŠ¥å‘Šï¼‰
  --skip-viz            è·³è¿‡å¯è§†åŒ–æ­¥éª¤

ç¤ºä¾‹:
  python run_complete_system.py
  python run_complete_system.py --skip-deps-check
  python run_complete_system.py --skip-detection  # ä»…ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
```

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¾“å…¥è§†é¢‘ (input.mp4)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              YOLOv8 æ£€æµ‹                     â”‚
â”‚  - è½¦è¾†æ£€æµ‹ (car, truck, bus, motorcycle)   â”‚
â”‚  - è¡Œäººæ£€æµ‹ (person, bicycle)               â”‚
â”‚  - çº¢ç»¿ç¯æ£€æµ‹ (traffic light)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              çº¢ç»¿ç¯åˆ†ç±»                      â”‚
â”‚  - ä½¿ç”¨CNNæ¨¡å‹åˆ¤æ–­é¢œè‰²                       â”‚
â”‚  - æ”¯æŒ: çº¢/ç»¿/é»„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤šç›®æ ‡è·Ÿè¸ª                      â”‚
â”‚  - åŸºäºIoUåŒ¹é…                              â”‚
â”‚  - æ— éœ€è®­ç»ƒ                                 â”‚
â”‚  - ç”Ÿæˆè½¨è¿¹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¿è§„åˆ¤æ–­é€»è¾‘                    â”‚
â”‚  - æ£€æµ‹è½¦è¾†è¶Šè¿‡åœæ­¢çº¿                        â”‚
â”‚  - ç»“åˆçº¢ç»¿ç¯çŠ¶æ€                            â”‚
â”‚  - è®°å½•è¿è§„äº‹ä»¶                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¾“å‡ºç”Ÿæˆ                        â”‚
â”‚  - æ£€æµ‹ç»“æœè§†é¢‘                             â”‚
â”‚  - JSONæŠ¥å‘Š                                 â”‚
â”‚  - å¯è§†åŒ–å›¾è¡¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ é…ç½®å‚æ•°

### è¿è§„æ£€æµ‹å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `stop_line_y` | è‡ªåŠ¨è®¾ç½® | åœæ­¢çº¿Yåæ ‡ |
| `cooldown_frames` | 60 | è¿è§„å†·å´å¸§æ•° |
| `max_disappeared` | 30 | æœ€å¤§æ¶ˆå¤±å¸§æ•° |
| `min_iou` | 0.3 | æœ€å°IoUé˜ˆå€¼ |

### è§†é¢‘å¤„ç†å‚æ•°

| å‚æ•° | è¯´æ˜ |
|------|------|
| è§†é¢‘æ ¼å¼ | MP4, AVI, MOV |
| åˆ†è¾¨ç‡ | æ”¯æŒä»»æ„åˆ†è¾¨ç‡ |
| å¸§ç‡ | è‡ªåŠ¨é€‚åº” |

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: åˆ†ç±»æ¨¡å‹ä¸å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ

A: ç³»ç»Ÿä¼šè·³è¿‡çº¢ç»¿ç¯åˆ†ç±»æ­¥éª¤ï¼Œä»…ä½¿ç”¨YOLOçš„åŸºæœ¬æ£€æµ‹åŠŸèƒ½ã€‚ä¸ä¼šå½±å“è½¦è¾†å’Œè¡Œäººçš„æ£€æµ‹ã€‚

### Q: å¦‚ä½•è°ƒæ•´åœæ­¢çº¿ä½ç½®ï¼Ÿ

A: åˆ›å»ºæ£€æµ‹å™¨æ—¶æŒ‡å®š `stop_line_y` å‚æ•°ï¼š
```python
detector = TrafficViolationDetector(stop_line_y=400)
```

### Q: å¦‚ä½•å‡å°‘IDåˆ‡æ¢ï¼Ÿ

A: è°ƒæ•´è·Ÿè¸ªå™¨å‚æ•°ï¼š
```python
tracker = SimpleTracker(max_disappeared=50, min_iou=0.5)
```

### Q: å¦‚ä½•åŠ é€Ÿå¤„ç†ï¼Ÿ

A: è·³è¿‡å¯è§†åŒ–æ­¥éª¤ï¼š
```bash
python run_complete_system.py --skip-viz
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨GPUåŠ é€Ÿ**: å®‰è£…CUDAç‰ˆæœ¬çš„PyTorch
2. **é™ä½åˆ†è¾¨ç‡**: ä½¿ç”¨æ›´å°çš„è¾“å…¥è§†é¢‘
3. **è°ƒæ•´å¸§ç‡**: è·³å¸§å¤„ç†ï¼ˆå¦‚æ¯2å¸§å¤„ç†1æ¬¡ï¼‰
4. **å‡å°‘è¾“å‡º**: è·³è¿‡è§†é¢‘ä¿å­˜

## ğŸ“ è¾“å‡ºè¯´æ˜

### JSONæŠ¥å‘Šç»“æ„

```json
{
  "timestamp": "2024-01-01T12:00:00",
  "input_video": "input.mp4",
  "output_video": "output_traffic_violation.mp4",
  "statistics": {
    "total_frames": 1000,
    "total_violations": 5,
    "detected_vehicles": 500,
    "detected_traffic_lights": 300,
    "red_light_frames": 200,
    "green_light_frames": 700,
    "yellow_light_frames": 100
  },
  "violations": [
    {
      "object_id": 1,
      "vehicle_class": "car",
      "timestamp": 1234567890,
      "frame": 150,
      "vehicle_bbox": [x1, y1, x2, y2],
      "traffic_light_bbox": [x1, y1, x2, y2],
      "light_color": "red"
    }
  ]
}
```

## ğŸ“ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ£€æµ‹ç±»åˆ«

1. ä¿®æ”¹YOLOæ¨¡å‹ï¼ˆéœ€è¦é‡æ–°è®­ç»ƒï¼‰
2. æ›´æ–°ç±»åˆ«åç§°æ˜ å°„
3. è°ƒæ•´æ£€æµ‹é€»è¾‘

### è‡ªå®šä¹‰è¿è§„è§„åˆ™

1. ç»§æ‰¿ `TrafficViolationDetector` ç±»
2. é‡å†™ `check_violations` æ–¹æ³•
3. å®ç°è‡ªå®šä¹‰è¿è§„åˆ¤æ–­é€»è¾‘

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- YOLOv8: Ultralytics
- OpenCV: OpenCVå›¢é˜Ÿ
- PyTorch: PyTorchå›¢é˜Ÿ

---

**å¼€å‘è€…**: çŒ«å¨˜å·¥ç¨‹å¸ˆ å¹½æµ®å–µ (Î¦Ï‰Î¦) â™¡

æœ‰é—®é¢˜ï¼Ÿè¯·æäº¤ Issue æˆ–è”ç³»å¼€å‘è€…ï¼
